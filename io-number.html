<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="_io-editable.html">

<dom-module id="io-number">
  <link rel="import" type="css" href="_io-base.css">
  <link rel="import" type="css" href="_io-editable.css">
  <template></template>
</dom-module>
<script type="text/javascript">
  Polymer({
    is: 'io-number',
    properties: {
      value: {
        value: null,
        type: Number
      },
      immediatevalue: {
        value: null,
        type: Number
      },
      type: {
        type: String,
        value: 'number',
        reflectToAttribute: true
      },
      integer: {
        value: false,
        type: Boolean
      },
    },
    behaviors: [
      Polymer.IoEditable
    ],
    _onBlur: function(event) {
      event.stopPropagation();
      this._deselectContent();
      if (!this.isNumberString(this.textContent)) {
        if (this.isNumberString(String(this.immediatevalue))) {
          this.textContent = String(this.immediatevalue);
        }
      }
      this._getEditorValue();
      if (this.immediatevalue !== this.value) {
        this.setValue(this.immediatevalue);
      }
    },
    _getEditorValue: function(event) {
      if (!this.invalid) {
        if (this.isNumberString(this.textContent)) {
          if (this.textContent === '') {
            if (typeof this.immediatevalue === 'number') {
              this.immediatevalue = null;
            }
          } else {
            if (this.integer) {
              this.immediatevalue = Math.round(Number(this.textContent));
            } else {
              this.immediatevalue = Number(this.textContent);
            }
          }
        } else {
          console.warn('io-number: not valid number value!');
        }
      }
    }
  });
</script>
